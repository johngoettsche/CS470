<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.6" />
<title>Embedded Profiler - User Manual</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul {
padding-left: 1em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}

/* Customization of AsciiDoc 8.6.6 stylesheet */
img {
    max-width: 100%;
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(3);
/*]]>*/
</script>
</head>
<body class="article" style="max-width:60em">
<div id="header">
<h1>Embedded Profiler - User Manual</h1>
<span id="author">Eccam s.r.o.</span><br />
<span id="email"><tt>&lt;<a href="mailto:&#101;&#109;&#98;&#101;&#100;&#100;&#101;&#100;&#112;&#114;&#111;&#102;&#105;&#108;&#101;&#114;&#64;&#101;&#99;&#99;&#97;&#109;&#46;&#99;&#111;&#109;">&#101;&#109;&#98;&#101;&#100;&#100;&#101;&#100;&#112;&#114;&#111;&#102;&#105;&#108;&#101;&#114;&#64;&#101;&#99;&#99;&#97;&#109;&#46;&#99;&#111;&#109;</a>&gt;</tt></span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>Embedded Profiler (EProfiler) is a multiplatform low overhead C/C++ profiler designed to measure performance
on embedded system targets. Linux, Windows, Windows-CE and Android platforms are supported. On Linux and Android,
gcc compiler is supported; on Windows both MinGW (Minimalist GNU for Windows) and MSVC (Microsoft Visual Studio)
compilers can be used.</p></div>
<div class="paragraph"><p>Profiler is implemented as a dynamic (shared) library or as a static library. It is based on automatic
instrumentation of functions done by the C/C++ compiler.</p></div>
<div class="paragraph"><p>Profiling of C/C++ application can be done either automatically or manually. Automatic profiling needs no
source code modifications. Manual profiling requires using the <a href="#EProfilerAPI">API</a> to specify the parts
of the source code to be profiled. The resulting log can be opened in
<a href="#PerformanceAnalyzer">Performance Analyzer</a>, a GUI application running on PC with several views designed for
comfortable log analysis.</p></div>
<div class="paragraph"><p>Besides of that, Embedded Profiler has low impact to C/C++ applications, and it also implements
<a href="#OverheadCorrection">unique feature</a> to estimate duration of functions as if they were not profiled.</p></div>
<div class="paragraph"><p>Embedded Profiler library exports <a href="#EProfilerTimer">special timer</a> with processor cycles resolution using
the <a href="#EProfilerAPI">API</a>. The timer resolution can be converted to nanoseconds or microseconds as well.
This allows C/C++ applications to use Embedded Profiler library also as a multiplatform high resolution timer.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_profiling">2. Profiling</h2>
<div class="sectionbody">
<div class="paragraph"><p>Profiling can be done in two different ways:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Automatically
</dt>
<dd>
<p>
This approach does not need any modification of a source code. The whole application is
                profiled automatically. Even constructors and destructors of static global objects are
                profiled.
</p>
</dd>
<dt class="hdlist1">
Manually
</dt>
<dd>
<p>
This approach requires small modification of a source code. The
                <a href="#EProfilerAPI">EProfiler API</a> is used to configure embedded profiler and to specify
                the part of the source code to be profiled.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Embedded profiler supports two different profiling modes:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Call Tree Mode
</dt>
<dd>
<p>
This mode is the profiler default mode and generates complete function call tree of the profiled application with
                     duration of each function. The resulting log can be analyzed in <a href="#PerformanceAnalyzer">Performance Analyzer</a> using
                     several views. However, the log can easily become quite huge. This mode has very low
                     overhead which can be measured by special command-line tool (see
                     <a href="#OverheadCorrection">Profiling overhead correction</a>). Using this measured overhead,
                     <a href="#PerformanceAnalyzer">Performance Analyzer</a> implements unique feature to estimate duration of functions
                     as if they were not profiled.
</p>
</dd>
<dt class="hdlist1">
Function List Mode
</dt>
<dd>
<p>
This mode generates only list of profiled functions with number of callings
                     and total duration. The resulting log is very small and can be analyzed in
                     <a href="#PerformanceAnalyzer">Performance Analyzer</a> using one special view.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Because the profiling is based on instrumentation of functions, it is necessary to compile the profiled
application before profiling. The next chapters describe how to do it.</p></div>
<div class="sect2">
<h3 id="ProjectPreparation">2.1. Project preparation</h3>
<div class="paragraph"><p>These steps describe how to compile an application to be prepared for profiling using embedded profiler.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">
<div class="paragraph"><p>To get the best results, you should profile <em>release</em> version of your application (with all compiler
optimization flags etc.); no built-in debug information is needed for profiler operation.</p></div>
</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="_gcc_and_mingw_compilers">2.1.1. GCC and MinGW compilers</h4>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
For all profiled application modules add following compiler switch:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>-finstrument-functions</tt></pre>
</div></div>
</li>
<li>
<p>
Functions which can be filtered out from profiling:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>-finstrument-functions-exclude-function-list
-finstrument-functions-exclude-file-list</tt></pre>
</div></div>
</li>
<li>
<p>
For all profiled application modules add the following linker argument:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>-Wl,-Map=ProjectName.map</tt></pre>
</div></div>
</li>
<li>
<p>
Link profiled application with appropriate EProfiler library:
</p>
<div class="ulist"><ul>
<li>
<p>
Linux 32-bit
</p>
<div class="literalblock">
<div class="content">
<pre><tt>EProfiler/linux32-gcc-intel/lib/libEProfiler.so for shared library,
EProfiler/linux32-gcc-intel/lib/libEProfilerStatic.a for static library,</tt></pre>
</div></div>
</li>
<li>
<p>
Linux 64-bit
</p>
<div class="literalblock">
<div class="content">
<pre><tt>EProfiler/linux64-gcc-intel/lib/libEProfiler.so for shared library,
EProfiler/linux64-gcc-intel/lib/libEProfilerStatic.so for static library,</tt></pre>
</div></div>
</li>
<li>
<p>
MinGW 32-bit
</p>
<div class="literalblock">
<div class="content">
<pre><tt>EProfiler/windows32-mingw-intel/lib/libEProfiler.dll.a for dynamic library,
EProfiler/windows32-mingw-intel/lib/libEProfilerStatic.a for static library,</tt></pre>
</div></div>
</li>
<li>
<p>
MinGW 64-bit
</p>
<div class="literalblock">
<div class="content">
<pre><tt>EProfiler/windows64-mingw-intel/lib/libEProfiler.dll.a for dynamic library,
EProfiler/windows64-mingw-intel/lib/libEProfilerStatic.a for static library,</tt></pre>
</div></div>
</li>
<li>
<p>
Android ARM
</p>
<div class="literalblock">
<div class="content">
<pre><tt>EProfiler/android-gcc-arm/lib/libEProfiler.so for shared library or
EProfiler/android-gcc-arm/lib/libEProfilerStatic.a for static library.</tt></pre>
</div></div>
</li>
</ul></div>
</li>
</ol></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important" />
</td>
<td class="content">
<div class="paragraph"><div class="title">Linux GCC and MinGW</div><p>When you link against the static library on Linux GCC or MinGW targets, you must link <tt>pthread</tt> library as well.</p></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important" />
</td>
<td class="content">
<div class="paragraph"><div class="title">Linux GCC and MinGW</div><p>When you link against the dynamic library on Linux GCC or MinGW targets, make sure that you have on the linker
command line the EProfiler library at the end.</p></div>
<div class="paragraph"><p>Otherwise you can get the linker error that <tt>__cyg_profile_func_enter</tt> and <tt>__cyg_profile_func_exit</tt> are
undefined references.</p></div>
</td>
</tr></table>
</div>
<div class="admonitionblock" id="AndroidTarget">
<table><tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important" />
</td>
<td class="content">
<div class="paragraph"><div class="title">Android ARM</div><p>On Android ARM targets it is required to use kernel module which enables cycle counting.</p></div>
<div class="paragraph"><p>Make sure that kernel module <tt>EProfiler/android-gcc-arm/module/eprofiler_arm_counter.ko</tt> is
properly loaded in memory (e.g. use insmod).</p></div>
<div class="paragraph"><p>Android currently does not support RPATH and by default loads system libraries only.
Make sure that the environment variable <tt>LD_LIBRARY_PATH</tt> contains full path to
<tt>EProfiler/android-gcc-arm/lib/</tt>.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_msvc_compiler_windows">2.1.2. MSVC compiler (Windows)</h4>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
For all profiled application modules add the following compiler switches:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>/GH /Gh</tt></pre>
</div></div>
</li>
<li>
<p>
For all profiled application modules add the following linker argument:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>/MAP:ProjectName.map</tt></pre>
</div></div>
</li>
<li>
<p>
Link profiled application with appropriate EProfiler library:
</p>
<div class="ulist"><ul>
<li>
<p>
Windows 32-bit
</p>
<div class="literalblock">
<div class="content">
<pre><tt>EProfiler/windows32-msvc-intel/lib/EProfiler.lib for dynamic library,
EProfiler/windows32-msvc-intel/lib/EProfilerStatic.lib for static library,</tt></pre>
</div></div>
</li>
<li>
<p>
Windows 64-bit
</p>
<div class="literalblock">
<div class="content">
<pre><tt>EProfiler/windows64-msvc-intel/lib/EProfiler.lib for dynamic library or
EProfiler/windows64-msvc-intel/lib/EProfilerStatic.lib for static library.</tt></pre>
</div></div>
</li>
</ul></div>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="_msvc_compiler_windows_ce_sh4_processor">2.1.3. MSVC compiler (Windows CE, SH4 processor)</h4>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
For all profiled application modules add the following compiler switch:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>/callcap</tt></pre>
</div></div>
</li>
<li>
<p>
For all profiled application modules add the following linker argument:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>/MAP:ProjectName.map</tt></pre>
</div></div>
</li>
<li>
<p>
Link profiled application with appropriate EProfiler library:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>EProfiler/windowsce-msvc-sh4/lib/EProfiler.lib for dynamic library or
EProfiler/windowsce-msvc-sh4/lib/EProfilerStatic.lib for static library.</tt></pre>
</div></div>
</li>
</ol></div>
</div>
</div>
<div class="sect2">
<h3 id="_automatic_profiling">2.2. Automatic profiling</h3>
<div class="paragraph"><p>The following steps describe how to use embedded profiler in automatic profiling:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Set environment variable <tt>EPROF_AUTOSTART_ENABLED</tt> (or registry value<br />
<tt>HKLM\SOFTWARE\Eccam\EProfiler\AutostartEnabled</tt> for Windows CE build) to <tt>1</tt>.
</p>
</li>
<li>
<p>
Select profiling mode - by default it is Call Tree Mode, if Function List Mode is required,
  set environment variable <tt>EPROF_FUNCTION_LIST_ENABLED</tt> (or registry value<br />
<tt>HKLM\SOFTWARE\Eccam\EProfiler\FunctionListEnabled</tt> for Windows CE build) to <tt>1</tt>.
</p>
</li>
<li>
<p>
Optionally set environment variable <tt>EPROF_MEMORY_SIZE</tt> (or registry value<br />
<tt>HKLM\SOFTWARE\Eccam\EProfiler\MemorySize</tt> for Windows CE build) to set profiler memory size in bytes. Default is <tt>1
MB</tt> for <em>Call Tree Mode</em> and cca <tt>40 KB</tt> (sufficient memory to store <tt>1024</tt> functions) for <em>Function List Mode</em>.
</p>
</li>
<li>
<p>
Run application.
</p>
</li>
<li>
<p>
The profiler log can be found in files named in format <tt>eprof_thread_XXXX.epl</tt> for each thread in the same directory from which the program was launched.
</p>
</li>
</ol></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important" />
</td>
<td class="content">
<div class="paragraph"><p>The duration of functions is measured in processor cycles. The measured processor cycles are converted to time
using CPU frequency which was set before profiling starts. However the CPU frequency can be changed dynamically
on modern processors. Therefore to be sure that converted times are correct, it is necessary to fix processor
frequency before profiling. Otherwise the profiling log analysis should be based on processor cycles only.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_manual_profiling">2.3. Manual profiling</h3>
<div class="paragraph"><p>The following steps describe how to use embedded profiler in manual profiling:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
In application sources, add <tt>#include "EProfiler/include/EProfiler.h"</tt>
</p>
</li>
<li>
<p>
Optionally call <tt>EProfilerConfigureFile()</tt> or <tt>EProfilerConfigureMemory()</tt> before profiling (per each thread).
</p>
</li>
<li>
<p>
Call <tt>EProfilerStart()</tt> to start profiling (per each thread).
</p>
</li>
<li>
<p>
Optionally call <tt>EProfilerFlush()</tt> to write profiler data stored in memory into the file.
</p>
</li>
<li>
<p>
Call <tt>EProfilerStop()</tt> to stop profiling (per each thread).
</p>
</li>
<li>
<p>
Make sure that environment variable <tt>EPROF_AUTOSTART_ENABLED</tt> (or registry value<br />
<tt>HKLM\SOFTWARE\Eccam\EProfiler\AutostartEnabled</tt> for Windows CE build) is not defined or it is set to <tt>0</tt>.
</p>
</li>
<li>
<p>
Select profiling mode - by default it is Call Tree Mode, if Function List Mode is required, set environment
  variable <tt>EPROF_FUNCTION_LIST_ENABLED</tt> (or registry value<br />
<tt>HKLM\SOFTWARE\Eccam\EProfiler\FunctionListEnabled</tt> for Windows CE build) to <tt>1</tt>.
</p>
</li>
<li>
<p>
Run application.
</p>
</li>
<li>
<p>
The profiler log can be found in files named in format <tt>eprof_thread_XXXX.epl</tt> for each thread in current directory,
or as configured by <tt>EProfiler::ConfigureProfFile()</tt> call.
</p>
</li>
</ol></div>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>Example code:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.3
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"EProfiler/include/EProfiler.h"</span>

<span style="color: #990000">...</span>

<span style="font-weight: bold"><span style="color: #000000">EProfilerConfigureFile</span></span><span style="color: #990000">(</span>p_prof_file_name<span style="color: #990000">);</span>                      <span style="font-style: italic"><span style="color: #9A1900">// optional</span></span>
<span style="font-weight: bold"><span style="color: #000000">EProfilerConfigureMemory</span></span><span style="color: #990000">(</span>prof_memory_size<span style="color: #990000">,</span> p_prof_memory<span style="color: #990000">);</span>     <span style="font-style: italic"><span style="color: #9A1900">// optional</span></span>

<span style="font-weight: bold"><span style="color: #000000">EProfilerStart</span></span><span style="color: #990000">();</span>

<span style="color: #990000">...</span>     <span style="font-style: italic"><span style="color: #9A1900">// code to profile</span></span>
<span style="font-weight: bold"><span style="color: #000000">EProfilerFlush</span></span><span style="color: #990000">();</span>    <span style="font-style: italic"><span style="color: #9A1900">// optional - force flushing of acquired data</span></span>
<span style="color: #990000">...</span>     <span style="font-style: italic"><span style="color: #9A1900">// code to profile</span></span>

<span style="font-weight: bold"><span style="color: #000000">EProfilerStop</span></span><span style="color: #990000">();</span></tt></pre></div></div>
<div class="paragraph"><p>Profiling can be started and stopped at different scope, so it is possible to start profiling in a function
and stop at anytime after that function has returned. Starting in a function and stopping in any function that is
nested in that function is possible as well.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important" />
</td>
<td class="content">
<div class="paragraph"><p>Threads are profiled independently - each has to be explicitly started and stopped and each has its own
profiling memory and log file.</p></div>
</td>
</tr></table>
</div>
</div></div>
<div class="sect3">
<h4 id="EProfilerAPI">2.3.1. EProfiler API</h4>
<div class="dlist"><dl>
<dt class="hdlist1">
<tt>TEProfilerResult</tt> <strong><tt>EProfilerConfigureFile</tt></strong><tt>(const char* p_prof_file_name)</tt>
</dt>
<dd>
<div class="dlist"><dl>
<dt class="hdlist1">
Description
</dt>
<dd>
<p>
Configure profiler file name for the current thread.<br />
    This method can be called only before <tt>EProfilerStart()</tt> or after <tt>EProfilerStop()</tt>. If this method is not
    called, profiler will use default file name.
</p>
</dd>
<dt class="hdlist1">
Parameters
</dt>
<dd>
<p>
<tt>p_prof_file_name</tt> - Pointer to the profiler file name to use or NULL to use default file name.
</p>
</dd>
<dt class="hdlist1">
Return Value
</dt>
<dd>
<p>
<tt>EProfilerSuccess</tt> - success<br />
                   <tt>EProfilerFailure</tt> - failure, the profiler has been already started
</p>
</dd>
</dl></div>
</dd>
<dt class="hdlist1">
<tt>TEProfilerResult</tt> <strong><tt>EProfilerConfigureMemory</tt></strong><tt>(size_t prof_memory_size, void* p_prof_memory)</tt>
</dt>
<dd>
<div class="dlist"><dl>
<dt class="hdlist1">
Description
</dt>
<dd>
<p>
Configure profiler memory for the current thread.<br />
    This method can be called only before <tt>EProfilerStart()</tt> or after <tt>EProfilerStop()</tt>. If this method is not
    called, profiler memory will have default size and it will be allocated on heap.
    Default profiler memory size in call tree mode is 1MB (1048576 bytes).
    Default profiler memory size in function list mode is 40KB (40960 bytes).
</p>
</dd>
<dt class="hdlist1">
Parameters
</dt>
<dd>
<p>
<tt>prof_memory_size</tt> - Profiler memory size in bytes to use or 0 to use default memory size.<br />
                 <tt>p_prof_memory</tt> - Pointer to memory to use or NULL to allocate memory on heap.
</p>
</dd>
<dt class="hdlist1">
Return Value
</dt>
<dd>
<p>
<tt>EProfilerSuccess</tt> - success<br />
                   <tt>EProfilerFailure</tt> - failure, the profiler has been already started or given memory size is
                   too small.
</p>
</dd>
</dl></div>
</dd>
<dt class="hdlist1">
<tt>void</tt> <strong><tt>EProfilerStart</tt></strong><tt>()</tt>
</dt>
<dd>
<div class="dlist"><dl>
<dt class="hdlist1">
Description
</dt>
<dd>
<p>
Starts profiling for the current thread.
</p>
</dd>
</dl></div>
</dd>
<dt class="hdlist1">
<tt>void</tt> <strong><tt>EProfilerFlush</tt></strong><tt>()</tt>
</dt>
<dd>
<div class="dlist"><dl>
<dt class="hdlist1">
Description
</dt>
<dd>
<p>
Flushes profiling memory to the profiler file for the current thread.<br />
                  This method stores entry and exit of virtual function <tt>InternalFlushing</tt> to measure consumed
                  time by flushing. It can be called only between <tt>EProfilerStart()</tt> and <tt>EProfilerStop()</tt>.
</p>
</dd>
</dl></div>
</dd>
<dt class="hdlist1">
<tt>void</tt> <strong><tt>EProfilerStop</tt></strong><tt>()</tt>
</dt>
<dd>
<div class="dlist"><dl>
<dt class="hdlist1">
Description
</dt>
<dd>
<p>
Stops profiling for the current thread. This call flushes profiling memory to the profiler
                  file and closes the file.
</p>
</dd>
</dl></div>
</dd>
</dl></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_performance_analysis">3. Performance Analysis</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section describes how to analyze logs with profiling data generated by embedded profiler.</p></div>
<div class="sect2">
<h3 id="_demangle_function_names_in_profiled_application">3.1. Demangle function names in profiled application</h3>
<div class="paragraph"><p>Function names are resolved by the profiler using map files created during <a href="#ProjectPreparation">project preparation</a> part,
and the names are mangled. <a href="#PerformanceAnalyzer">Performance Analyzer</a> is able to demangle the symbols automatically
for map files generated using the same compiler type as was used for <a href="#PerformanceAnalyzer">Performance Analyzer</a> build.
So e.g. <a href="#PerformanceAnalyzer">Performance Analyzer</a> built using
MSVC compiler can demangle map files from MSVC compiler, but not from GCC compiler. If you are unable to run
<a href="#PerformanceAnalyzer">Performance Analyzer</a> built with the target compiler platform, you can convert the mapfile
into a special demangled symbol file manually. The conversion utility is supported on all platforms supported by embedded
profiler, so it can be done directly on the target platform. The resulting symbol file, together with the log file, are
completely self-contained, and as such can be processed and analyzed on any platform, regardless of the platform they come from.</p></div>
<div class="paragraph"><p>The following sections describe how to manually create this symbol file.</p></div>
<div class="sect3">
<h4 id="_gcc_mingw_and_msvc_compilers">3.1.1. GCC, MinGW and MSVC compilers</h4>
<div class="paragraph"><p>Generate single symbol file from all map files generated during compilation by command:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>PerformanceAnalyzer/'platform-name'/bin/EProfilerSymGen \
module1.map [moduleN.map...] ProjectName.sym</tt></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_msvc_compiler_windows_ce">3.1.2. MSVC compiler (Windows CE)</h4>
<div class="paragraph"><p>Generate symbol file from all map files (if <tt>wathunk.map</tt> is present, <tt>.thunk.lis</tt> files are needed too)
generated during compilation by command:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>PerformanceAnalyzer/windows32-msvc-intel/bin/EProfilerSymGen.exe \
module1.map [moduleN.map...] ProjectName.sym</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">
<div class="paragraph"><div class="title">Post-build steps</div><p>If it is easy enough to set up a post-build step for each project in your building environment, it could make
generation even easier. Your post-build step just needs to run:<br /></p></div>
<div class="literalblock">
<div class="content">
<pre><tt>./EProfilerSymGen path_to_project_map_files/*.map ProjectName.sym</tt></pre>
</div></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="PerformanceAnalyzer">3.2. Performance Analyzer</h3>
<div class="paragraph"><p><a href="#PerformanceAnalyzer">Performance Analyzer</a> is a PC GUI application for exploring log files generated by embedded profiler.
The following steps describe basic usage of this application:</p></div>
<div class="ulist"><ul>
<li>
<p>
The <a href="#PerformanceAnalyzer">Performance Analyzer</a> can be found in directory <tt>PerformanceAnalyzer/</tt><em><tt>platform-name</tt></em><tt>/bin</tt> where<br />
  <em><tt>platform-name</tt></em> can be <tt>linux32-gcc-intel</tt>, <tt>linux64-gcc-intel</tt>, <tt>windows32-msvc-intel</tt>,<br />
  <tt>windows64-msvc-intel</tt>, <tt>windows32-mingw-intel</tt> or <tt>windows64-mingw-intel</tt>.
</p>
</li>
<li>
<p>
Run <tt>PerformanceAnalyzer</tt>.
</p>
</li>
<li>
<p>
Select Menu <em>File &#8594; Open</em> to open profiler log with mapfile(s) or symbol file corresponding to the profiled application.
  Optionally, you can provide log file and symbol/map file names as parameters when starting the application.
  Use <em>-h</em> parameter for exact command syntax.
</p>
</li>
<li>
<p>
There are several view types which can be opened from the menu <em>View</em>:
</p>
<div class="dlist"><dl>
<dt class="hdlist1">
Call Tree
</dt>
<dd>
<p>
Displays function call tree of profiled application. This view is default for Call
                            Tree Mode and it is disabled for Function List Mode.
</p>
</dd>
<dt class="hdlist1">
Grouped Call Tree
</dt>
<dd>
<p>
Similar to Call Tree, but this view groups the same consecutive function calls as
                            a simplification for large logs analysis. This view is disabled for Function List
                            Mode.
</p>
</dd>
<dt class="hdlist1">
Functions per Modules
</dt>
<dd>
<p>
Displays all functions calls grouped by modules and function names. This view is
                            disabled for Function List Mode.
</p>
</dd>
<dt class="hdlist1">
Functions List
</dt>
<dd>
<p>
Displays all functions called by application grouped by function name. This view is
                            default for Function List Mode.
</p>
</dd>
</dl></div>
</li>
<li>
<p>
It is possible to show selected function call in other view using popup menu:
</p>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/show_in_view.png">
<img src="./images/show_in_view.png" alt="Show in view" />
</a>
</div>
</div>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">
<div class="paragraph"><p>Suspicious functions can be easily found in the <em>Function List</em> view and then shown in their context using the
<em>Call Tree</em> view.</p></div>
</td>
</tr></table>
</div>
<div class="ulist"><ul>
<li>
<p>
Search toolbars allows to search recursively in a tree view by function name.
</p>
</li>
<li>
<p>
Opened log can be filtered using a range defined by start and end timestamp in menu <em>Edit &#8594; Set filter</em>.
  Filter can be then turned on/off with menu <em>Edit &#8594; Timeline Filter</em>.
  This function is disabled for Function List Mode.
</p>
</li>
<li>
<p>
Time units can be changed from microseconds to processor cycles by menu item
  <em>Edit &#8594; Set Profiling Parameters &#8594; Display cycle count [cc] instead of time [Âµs]</em>.
</p>
</li>
<li>
<p>
Profiling overhead can be corrected using <a href="#OverheadCorrection">advanced features</a>.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">
<div class="paragraph"><div class="title">Android and Windows CE</div><p>Android and Windows CE platforms do not support <a href="#PerformanceAnalyzer">Performance Analyzer</a>, use Linux or Windows platforms instead.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_features">4. Additional features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_filtering_logs">4.1. Filtering logs</h3>
<div class="paragraph"><p>The <tt>EProfilerLogConverter</tt> command line tool converts embedded profiler logfile from binary format to
text format and vice versa. Therefore if the log contains functions that you are not interested in, it can be
easily filtered out using<br />
<tt>EProfilerLogConverter</tt> in pipeline with a filter.</p></div>
<div class="paragraph"><p>For example filtering log on Linux platform:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>./EProfilerLogConverter eprof_log -s ProjectName.sym | \
grep -v 'UnwantedFunction()' | ./EProfilerLogConverter - filtered_eprof_log</tt></pre>
</div></div>
<div class="paragraph"><p>The filter could be a simple <tt>grep</tt> based on function names or your own filter based on module name,
timestamp range, etc.</p></div>
<div class="paragraph"><p>Filtering can also be useful for reducing size of EProfiler log files.</p></div>
<div class="paragraph"><p>The <tt>EProfilerLogConverter</tt> can be found in directory <tt>PerformanceAnalyzer/</tt><em><tt>platform-name</tt></em><tt>/bin</tt>.</p></div>
</div>
<div class="sect2">
<h3 id="OverheadCorrection">4.2. Profiling overhead correction</h3>
<div class="paragraph"><p>Instrumentation comes with certain overhead which differs on each platform. This overhead is injected into
measured duration of functions. As an optional feature, this overhead can be measured with <tt>EProfilerOverhead</tt>
command line tool and used in <a href="#PerformanceAnalyzer">Performance Analyzer</a> to estimate duration of functions as if they were not
profiled.</p></div>
<div class="paragraph"><p>The following steps describe how to measure profiling overhead:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Find the <tt>EProfilerOverhead</tt> binary in directory <tt>EProfiler/</tt><em><tt>platform-name</tt></em><tt>/bin</tt>.
</p>
</li>
<li>
<p>
Run application:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>./EProfilerOverhead num_of_repetitions num_of_overhead_measurements \
[-l eprofiler_log_file]</tt></pre>
</div></div>
</li>
<li>
<p>
See help for overhead measuring guide:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>./EProfilerOverhead --help</tt></pre>
</div></div>
</li>
<li>
<p>
Use <tt>profiling overhead</tt> and <tt>measuring overhead</tt> in <a href="#PerformanceAnalyzer">Performance Analyzer</a> <em>Edit &#8594; Set Profiling Parameters</em>
dialog:
</p>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/overhead_correction.png">
<img src="./images/overhead_correction.png" alt="Overhead correction" />
</a>
</div>
</div>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="EProfilerTimer">4.3. Using EProfiler timer</h3>
<div class="paragraph"><p>EProfiler timer interface can be used as a cpu cycle accurate stopwatch. The following steps describe the usage:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
In application sources, add:
</p>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.3
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"EProfiler/include/EProfilerTimer.h"</span></tt></pre></div></div>
</li>
<li>
<p>
Measure elapsed time in processor cycles according to the following example:
</p>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.3
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">EProfilerTimer</span> my_timer<span style="color: #990000">;</span>
my_timer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Start</span></span><span style="color: #990000">();</span>
<span style="color: #990000">...</span>     <span style="font-style: italic"><span style="color: #9A1900">// code to measure</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">uint64_t</span> duration_in_processor_cycles <span style="color: #990000">=</span> my_timer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Stop</span></span><span style="color: #990000">();</span></tt></pre></div></div>
</li>
<li>
<p>
Link application against appropriate EProfiler <a href="#ProjectPreparation">dynamic library</a>.
</p>
</li>
</ol></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_by_step_tutorial">Appendix A: Step by step tutorial</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Example source code for profiling:</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.3
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;cstdio&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;ctime&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Foo</span>
<span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">Foo</span></span><span style="color: #990000">();</span>
    <span style="color: #990000">~</span><span style="font-weight: bold"><span style="color: #000000">Foo</span></span><span style="color: #990000">();</span>

    <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">Bar</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> p_message<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

Foo<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">Foo</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Foo initialization.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

Foo<span style="color: #990000">::~</span><span style="font-weight: bold"><span style="color: #000000">Foo</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Foo deinitilization.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">void</span> Foo<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">Bar</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> p_message<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p_message<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">GetValue</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">time</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">)</span> <span style="color: #990000">%</span> <span style="color: #993399">15</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">Multiply</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> value1<span style="color: #990000">,</span> <span style="color: #009900">int</span> value2<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> value2<span style="color: #990000">;</span> <span style="color: #990000">++</span>i<span style="color: #990000">)</span>
        result <span style="color: #990000">+=</span> value1<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">CalculateFactorial</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> value<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> result <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;=</span> value<span style="color: #990000">;</span> <span style="color: #990000">++</span>i<span style="color: #990000">)</span>
    <span style="color: #FF0000">{</span>
        result <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Multiply</span></span><span style="color: #990000">(</span>result<span style="color: #990000">,</span> i<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">Foo</span> foo<span style="color: #990000">;</span>
    foo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Bar</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"FooBar"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">int</span> value <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">GetValue</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">int</span> factorial <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">CalculateFactorial</span></span><span style="color: #990000">(</span>value<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Factorial of %d is %d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> value<span style="color: #990000">,</span> factorial<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><div class="title">Linux/GCC</div><p>Compile the example with the following command (assuming <tt>libEProfiler.so</tt> in the current directory):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>g++ -finstrument-functions -o sample -Wl,-Map=sample.map sample.cpp \
libEProfiler.so</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">
<div class="paragraph"><div class="title">Linux 64</div><p>When linking 32bit version of EProfiler library, <tt>-m32</tt> flag has to be used:<br /></p></div>
<div class="literalblock">
<div class="content">
<pre><tt>g++ -m32 -finstrument-functions -o sample -Wl,-Map=sample.map sample.cpp \
libEProfiler.so</tt></pre>
</div></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Generate the symbol file (assuming that <tt>EProfilerSymGen</tt> is located in current directory) (Optional):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>./EProfilerSymGen sample.map sample.sym</tt></pre>
</div></div>
<div class="paragraph"><p>For Call Tree Mode, run the example with automatic profiling (assuming <tt>libEProfiler.so</tt> in the current
directory):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>LD_LIBRARY_PATH=. EPROF_AUTOSTART_ENABLED=1 ./sample</tt></pre>
</div></div>
<div class="paragraph"><p>For Function List Mode, run the example with automatic profiling (assuming <tt>libEProfiler.so</tt> in the current
directory):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>LD_LIBRARY_PATH=. EPROF_AUTOSTART_ENABLED=1 EPROF_FUNCTION_LIST_ENABLED=1 ./sample</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">
<div class="paragraph"><div class="title">Android ARM</div><p>Make sure that <a href="#AndroidTarget">Android target</a> prerequisites are accomplished.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>The profiler log will be saved in the current directory with name <tt>eprof_thread_id.epl</tt>,<br />
e.g. <tt>eprof_thread_4f4.epl</tt>. This profiler log can be analyzed by <a href="#PerformanceAnalyzer">Performance Analyzer</a>:</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_gcc_open_dialog.png">
<img src="./images/tutorial_gcc_open_dialog.png" alt="GCC Open Dialog" />
</a>
</div>
</div>
<div class="paragraph"><p>Call Tree Mode:</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_gcc_call_tree_analyzer.png">
<img src="./images/tutorial_gcc_call_tree_analyzer.png" alt="GCC Performance Analyzer" />
</a>
</div>
</div>
<div class="paragraph"><p>Function List Mode:</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_gcc_func_list_analyzer.png">
<img src="./images/tutorial_gcc_func_list_analyzer.png" alt="GCC Performance Analyzer" />
</a>
</div>
</div>
<div class="paragraph"><div class="title">Windows/MSVC</div><p>Ensure that compiler uses <tt>/Gh /GH</tt> switches:</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_msvc_command_line.png">
<img src="./images/tutorial_msvc_command_line.png" alt="MSVC Compiler Switches" />
</a>
</div>
</div>
<div class="paragraph"><p>Ensure that linker has access to EProfiler.lib (in Additional Library Directories),</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_msvc_linker1.png">
<img src="./images/tutorial_msvc_linker1.png" alt="MSVC Linker Settings" />
</a>
</div>
</div>
<div class="paragraph"><p>that it links to <em>EProfiler.lib</em></p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_msvc_linker2.png">
<img src="./images/tutorial_msvc_linker2.png" alt="MSVC Linker Input" />
</a>
</div>
</div>
<div class="paragraph"><p>and that it produces the map file:</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_msvc_linker3.png">
<img src="./images/tutorial_msvc_linker3.png" alt="MSVC Linker Debugging" />
</a>
</div>
</div>
<div class="paragraph"><p>This sample is so simple that if you use release mode all functions will be inlined and
no call tree will be seen in <a href="#PerformanceAnalyzer">Performance Analyzer</a>. In this case, don&#8217;t forget to switch off
inlining to see all functions in sample:</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_msvc_inlining.png">
<img src="./images/tutorial_msvc_inlining.png" alt="MSVC Compiler Inlining" />
</a>
</div>
</div>
<div class="paragraph"><p>Generate the symbol file (assuming that <tt>EProfilerSymGen.exe</tt> is in current directory) (Optional):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>EProfilerSymGen.exe sample.map sample.sym</tt></pre>
</div></div>
<div class="paragraph"><p>For Call Tree Mode, run the example with automatic profiling (assuming that embedded profiler is installed in<br />
<tt>F:\Projects\PerfAnalysisTools\release</tt> directory):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>set EPROF_AUTOSTART_ENABLED=1
set PATH=%PATH%;^
F:\Projects\PerfAnalysisTools\release\EProfiler\windows32-msvc-intel\bin
sample.exe</tt></pre>
</div></div>
<div class="paragraph"><p>For Function List Mode, run the example with automatic profiling (assuming that embedded profiler is installed in<br />
<tt>F:\Projects\PerfAnalysisTools\release</tt> directory):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>set EPROF_AUTOSTART_ENABLED=1
set EPROF_FUNCTION_LIST_ENABLED=1
set PATH=%PATH%;^
F:\Projects\PerfAnalysisTools\release\EProfiler\windows32-msvc-intel\bin
sample.exe</tt></pre>
</div></div>
<div class="paragraph"><p>The profiler log will be saved in the current directory with name <tt>eprof_thread_id.epl</tt>,<br />
e.g. <tt>eprof_thread_4f4.epl</tt>. This profiler log can be analyzed by <a href="#PerformanceAnalyzer">Performance Analyzer</a>:</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_msvc_open_dialog.png">
<img src="./images/tutorial_msvc_open_dialog.png" alt="MSVC Open Dialog" />
</a>
</div>
</div>
<div class="paragraph"><p>Call Tree Mode:</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_msvc_call_tree_analyzer.png">
<img src="./images/tutorial_msvc_call_tree_analyzer.png" alt="MSVC Performance Analyzer" />
</a>
</div>
</div>
<div class="paragraph"><p>Function List Mode:</p></div>
<div class="imageblock">
<div class="content">
<a class="image" href="./images/tutorial_msvc_func_list_analyzer.png">
<img src="./images/tutorial_msvc_func_list_analyzer.png" alt="MSVC Performance Analyzer" />
</a>
</div>
</div>
<div class="openblock">
<div class="content">
<hr />
<div class="paragraph"><p>Copyright &#169; 2012-2013, Eccam, s.r.o. All rights reserved.</p></div>
</div></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2013-12-18 13:01:27 CET
</div>
</div>
</body>
</html>
